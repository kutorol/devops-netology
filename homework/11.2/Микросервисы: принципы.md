
# Домашнее задание к занятию "Микросервисы: принципы"

Вы работаете в крупной компанию, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps специалисту необходимо выдвинуть предложение по организации инфраструктуры, для разработки и эксплуатации.

## Задача 1: API Gateway 

Предложите решение для обеспечения реализации API Gateway. Составьте сравнительную таблицу возможностей различных программных решений. На основе таблицы сделайте выбор решения.

Решение должно соответствовать следующим требованиям:
- Маршрутизация запросов к нужному сервису на основе конфигурации
- Возможность проверки аутентификационной информации в запросах
- Обеспечение терминации HTTPS

Обоснуйте свой выбор.

#### Решение:

| Готовое решение    | Маршрутизация запросов на основе конфигурации | Возможность проверки аутентификационной информации в запросах | Обеспечение терминации HTTPS |
|--------------------|-----------------------------------------------|---------------------------------------------------------------|------------------------------|
| Amazon API Gateway |                       +                       |                               +                               |               +              |
| Yandex API Gateway |                       +                       |                               +                               |               +              |
| Kong Gateway       |                       +                       |                               +                               |               +              |
| Gloo               |                       +                       |                               +                               |               +              |
| Istio              |                       +                       |                               +                               |               +              |

Перечисленные выше api gateway удовлетворяют перечисленным требованиям. Самый популярный на данный момент - Kong. Он фокусируется на скорости. Как понял, у него маленькое latency и он может принимать больше запросов в секунду

## Задача 2: Брокер сообщений

Составьте таблицу возможностей различных брокеров сообщений. На основе таблицы сделайте обоснованный выбор решения.

Решение должно соответствовать следующим требованиям:
- Поддержка кластеризации для обеспечения надежности
- Хранение сообщений на диске в процессе доставки
- Высокая скорость работы
- Поддержка различных форматов сообщений
- Разделение прав доступа к различным потокам сообщений
- Протота эксплуатации

Обоснуйте свой выбор.

### Ответ

| Брокер   | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Kafka    | - возможность обработки больших объемов потоковых данных<br/>- записи удаляются только по истечении срока, что позволяет делать аналитику по записям, аудит или повторение обработки<br/>- нет поддержки разных протоколов<br/>- простое горизонтальное масштабирование<br/>- нет возможности настройки маршрутизации сообщений<br/>- строгий порядок записей без поддержки приоритетов<br/>- брокер работает по модели PULL (потребители сами считывают записи) |
| RabbitMQ | - поддержка множества протоколов (AMQP, MQTT, STOMP)<br/>- можно реализовать сложные сценарии маршрутизации сообщений<br/>- возможность настройки приоритезации сообщений<br/>- к очереди можно легко подключить сразу несколько consumers, что даст балансировку нагрузки<br/>- относительно сложно настраивается горизонтальное масштабирование<br/>- возможность работы по модели PUSH/PULL                                                                   |

Все указанные брокеры соответствуют требованиям выше: 

- есть поддержка кластеризации
- хранение сообщений на диске
- высокая скорость работы 
- поддержка различных форматов сообщений
- разделение прав
- простота эксплуатации

Но для микросервисной архитектуры более предпочтительным является
использование брокера RabbitMQ за счет того, что у него есть поддержка множества протоколов - это дает возможность не привязываться к конкретным технологиям и даже, в случае чего, сделать замену на другой брокер.
В микросервисной архитектуре возможны сложные сценарии маршрутизации или приоритезации сообщений, что опять же определяет выбор в сторону RabbitMQ.
